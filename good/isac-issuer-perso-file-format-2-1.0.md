# Introduction
## Version

To see current version and details of recent changes, please see [`Changelog`](#appendix--changelog).

# Specification

## File Naming Conventions

|      File type       |       Convention       |       Example       |
|----------------------|------------------------|---------------------|
| Personalization file | WWW_XXXX_YYYY_ZZZZ.xml | TRB_CRV_14_0072.xml |

| Value |                           Description                           |
|-------|-----------------------------------------------------------------|
| WWW   | Predefined value agreed with the client to define the filename. |
| XXXX  | First card product reference code.                              |
| YYYY  | Cards count.                                                    |
| ZZZZ  | File ID.                                                        |

## Data Elements

| Field name                                           | M | Type | Length  | Description                                                                                                                                                                                                         |
|------------------------------------------------------|---|------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| CARDGEN                                              | M | LIST |         | Header record for full personalization file data.                                                                                                                                                                   |
| PRODUCT                                              | M | LIST |         | Acts as the header for card records in the file.                                                                                                                                                                    |
| PRODUCT / PRODUCT_REF                                | M | ANS  | [1-12]  | Pre defined Product code agreed with the client.                                                                                                                                                                    |
| PRODUCT / RECORD                                     | M | LIST |         | Header record.                                                                                                                                                                                                      |
| PRODUCT / RECORD / REQUEST_TYPE                      | M | A    | [3-8]   | [Appendix B](#appendix--enum--card-generation-request-type)                                                                                                                                                         |
| PRODUCT / RECORD / UID                               | M | N    | [1-20]  | Unique card ID (Token) generated by the Tribe system.                                                                                                                                                               |
| PRODUCT / RECORD / CARRIER                           | M | LIST |         | Header record for the pagaging and delivery information.                                                                                                                                                            |
| PRODUCT / RECORD / CARRIER / TITLE                   | O | ANS  | [1-7]   | Title of the cardholder that should be added to the carrier, e.g. Mr, Miss, Mrs, etc.                                                                                                                               |
| PRODUCT / RECORD / CARRIER / FNAME                   | M | AS   | [1-50]  | Forename of the cardholder details that should be added to the carrier.                                                                                                                                             |
| PRODUCT / RECORD / CARRIER / SNAME                   | M | AS   | [1-50]  | Surname of the cardholder details that should be added to the carrier.                                                                                                                                              |
| PRODUCT / RECORD / CARRIER / ADD1                    | M | ANS  | [1-100] | First line of the delivery address.                                                                                                                                                                                 |
| PRODUCT / RECORD / CARRIER / ADD2                    | O | ANS  | [1-100] | Second line of the delivery address.                                                                                                                                                                                |
| PRODUCT / RECORD / CARRIER / ADD3                    | O | ANS  | [1-100] | Third line of the delivery address.                                                                                                                                                                                 |
| PRODUCT / RECORD / CARRIER / ADD4                    | O | ANS  | [1-100] | Fourth line of the delivery address.                                                                                                                                                                                |
| PRODUCT / RECORD / CARRIER / CITY                    | M | ANS  | [1-50]  | City of the delivery address.                                                                                                                                                                                       |
| PRODUCT / RECORD / CARRIER / POSTCODE                | M | ANS  | [1-9]   | Postcode or Zipcode for the delivery address.                                                                                                                                                                       |
| PRODUCT / RECORD / CARRIER / COUNTRY                 | M | N    | 3       | ISO 3 digit numeric value for the country.                                                                                                                                                                          |
| PRODUCT / RECORD / CARRIER / BULK_ADD1               | C | ANS  | [1-100] | First line of the bulk delivery address. If populated this supersedes the address destination above. All entries with the same Bulk delivery address will be grouped together. Mandatory if DELV_CODE present       |
| PRODUCT / RECORD / CARRIER / BULK_ADD2               | O | ANS  | [1-100] | Second line of the bulk delivery address. If populated this supersedes the address destination above. All entries with the same Bulk delivery address will be grouped together.                                     |
| PRODUCT / RECORD / CARRIER / BULK_ADD3               | O | ANS  | [1-100] | Third line of the bulk delivery address. If populated this supersedes the address destination above. All entries with the same Bulk delivery address will be grouped together.                                      |
| PRODUCT / RECORD / CARRIER / BULK_CITY               | C | ANS  | [1-50]  | City of the bulk delivery address. If populated this supersedes the address destination above. All entries with the same Bulk delivery address will be grouped together. Mandatory if DELV_CODE present             |
| PRODUCT / RECORD / CARRIER / BULK_POSTCODE           | C | ANS  | [1-9]   | Postcode/Zipcode of the bulk delivery address. If populated this supersedes the address destination above. All entries with the same Bulk delivery address will be grouped together. Mandatory if DELV_CODE present |
| PRODUCT / RECORD / CARRIER / BULK_COUNTRY            | C | N    | 3       | ISO 3 digit numeric value for the country. Mandatory if DELV_CODE present.                                                                                                                                          |
| PRODUCT / RECORD / CARRIER / CARRIER_TYPE            | M | ANS  | [1-50]  | Predefined value agreed with the client to define the carrier set.                                                                                                                                                  |
| PRODUCT / RECORD / CARRIER / CARRIER_LOGO_ID         | M | AN   | [1-12]  | Predefined value agreed with the client to define the company logo that should be added to the Carrier information.                                                                                                 |
| PRODUCT / RECORD / CARRIER / DELV_METHOD             | M | N    | [1-10]  | Predefined value agreed with the client to define the delivery method, e.g first class mail or courier.                                                                                                             |
| PRODUCT / RECORD / CARRIER / DELV_CODE               | C | AN   | [1-10]  | Identifies all cards that should be grouped together in the file for bulk delivery.                                                                                                                                 |
| PRODUCT / RECORD / CARRIER / FULFIL1                 | O | AN   | [1-10]  | Additional fulfillment parameter, possible values must be agreed separately with the client.                                                                                                                        |
| PRODUCT / RECORD / CARRIER / FULFIL2                 | O | AN   | [1-10]  | Additional fulfillment parameter, possible values must be agreed separately with the client.                                                                                                                        |
| PRODUCT / RECORD / CARRIER / LANG                    | O | A    | [2-3]   | Alpha character value for the language to print on the carrier information. Can also be used to define the CHIP language if not predefined with client codes supplied. Default: EN.                                 |
| PRODUCT / RECORD / CARD                              | M | LIST |         | Header record.                                                                                                                                                                                                      |
| PRODUCT / RECORD / CARD / TYPE                       | M | AS   | 8       | Currently set to "Chip&Mag".                                                                                                                                                                                        |
| PRODUCT / RECORD / CARD / CURRENCY                   | M | N    | 3       | ISO 3 digit numeric value for the currency.                                                                                                                                                                         |
| PRODUCT / RECORD / CARD / TRACK1                     | M | ANS  | [32-79] | ISO Standard Track 1 data.                                                                                                                                                                                          |
| PRODUCT / RECORD / CARD / TRACK2                     | M | ANS  | [28-50] | ISO Standard Track 2 data.                                                                                                                                                                                          |
| PRODUCT / RECORD / CARD / TRACK3                     | O | ANS  | [1-50]  | Reserved for future use.                                                                                                                                                                                            |
| PRODUCT / RECORD / CARD / EMBOSS_PAN                 | M | NS   | [1-24]  | Card Primary Account Number as printed on the card.                                                                                                                                                                 |
| PRODUCT / RECORD / CARD / EMBOSS_NAME                | M | ANS  | [3-26]  | Cardholder name as printed on the card.                                                                                                                                                                             |
| PRODUCT / RECORD / CARD / EMBOSS_START               | M | NS   | 5       | The month the card and CHIP application can be active in format MM/YY.                                                                                                                                              |
| PRODUCT / RECORD / CARD / EMBOSS_EXPIRY              | M | NS   | 5       | The month the card and CHIP application expire in format MM/YY.                                                                                                                                                     |
| PRODUCT / RECORD / CARD / EMBOSS_CVC2                | M | NS   | 8       | Full 7 digit CVC2/CVV2 value in format nnnn nnn (last 4 PAN numbers + space + cvc2 value).                                                                                                                          |
| PRODUCT / RECORD / CARD / EMBOSS_LINE4               | O | ANS  | [2-50]  | Freeform field as presented by the client at card creation to Tribe, to be embossed on the card.                                                                                                                    |
| PRODUCT / RECORD / CARD / THERMAL_LINE1              | O | AN   | [1-50]  | Freeform field as presented by the client at card creation to Tribe, to be pritned on the card.                                                                                                                     |
| PRODUCT / RECORD / CARD / THERMAL_LINE2              | O | AN   | [1-50]  | Freeform field as presented by the client at card creation to Tribe, to be pritned on the card.                                                                                                                     |
| PRODUCT / RECORD / CARD / IMAGE_ID                   | M | ANS  | [1-12]  | Predefined Image ID agreed with the client.                                                                                                                                                                         |
| PRODUCT / RECORD / CARD / LOGO_FRONT_ID              | M | ANS  | [1-12]  | Predefined logo for the front of the card agreed with the client.                                                                                                                                                   |
| PRODUCT / RECORD / CARD / LOGO_BACK_ID               | M | ANS  | [1-12]  | Predefined logo for the back of the card agreed with the client.                                                                                                                                                    |
| PRODUCT / RECORD / CARD / QRCODE                     | O | ANS  | [1-200] | Reserved for future use.                                                                                                                                                                                            |
| PRODUCT / RECORD / CARD / CHIP                       | M | LIST |         | Header record.                                                                                                                                                                                                      |
| PRODUCT / RECORD / CARD / CHIP / NAME                | M | ANS  | [3-26]  | Cardholder name for encoding on the chip.                                                                                                                                                                           |
| PRODUCT / RECORD / CARD / CHIP / PAN                 | M | N    | [16-19] | Card Primary Account Number for encoding on the chip.                                                                                                                                                               |
| PRODUCT / RECORD / CARD / CHIP / PAN_SEQ             | O | N    | 2       | PAN Sequence number for encoding on the chip.                                                                                                                                                                       |
| PRODUCT / RECORD / CARD / CHIP / START_DATE          | M | N    | 6       | Numeric applciation start date in format YYMMDD.                                                                                                                                                                    |
| PRODUCT / RECORD / CARD / CHIP / EXPIRY_DATE         | M | N    | 6       | Numeric applciation expiry date in format YYMMDD.                                                                                                                                                                   |
| PRODUCT / RECORD / CARD / CHIP / SERVICE_CODE        | M | N    | 3       | Service code value for encoding on the chip.                                                                                                                                                                        |
| PRODUCT / RECORD / CARD / CHIP / CHIP_TRACK_1        | M | ANS  | [1-79]  | CHIP Track 1 data following standard ISO & EMV formatting.                                                                                                                                                          |
| PRODUCT / RECORD / CARD / CHIP / CHIP_TRACK_2        | M | ANS  | [1-40]  | CHIP Track 2 data following standard ISO & EMV formatting.                                                                                                                                                          |
| PRODUCT / RECORD / CARD / CHIP / CHIP_TRACK_1_MSD_CL | M | ANS  | [1-79]  |                                                                                                                                                                                                                     |
| PRODUCT / RECORD / CARD / CHIP / CHIP_TRACK_2_MSD_CL | O | ANS  | [1-40]  | Reserved for future use.                                                                                                                                                                                            |
| PRODUCT / RECORD / CARD / CHIP / PINBLOCK            | M | AN   | 16      | Encrypted PIN data encrypted with preshared key with Tribe.                                                                                                                                                         |
| CARDSUM                                              | M | LIST |         | Record for the file summary.                                                                                                                                                                                        |
| CARDSUM / DATA_FORMAT_VERSION                        | M | N    | [1-3]   | Currently set to "9".                                                                                                                                                                                               |
| CARDSUM / FILEDATE                                   | M | NS   | 10      | Date on which the file was produced by the Tribe system. Format: DD-MM-YYYY.                                                                                                                                        |
| CARDSUM / FILETIME                                   | M | NS   | 8       | Time on which the file was produced by the Tribe system. Format: HH:MM:SS.                                                                                                                                          |
| CARDSUM / NO_OF_CARRIERS                             | M | N    | [1-8]   | Defines how many sets of packaged cards are for delivery in the file.                                                                                                                                               |
| CARDSUM / NO_OF_CARDS                                | M | N    | [1-8]   | Defines how many card records are present in the file.                                                                                                                                                              |
| CARDSUM / NO_OF_PRODUCTS                             | M | N    | [1-8]   | Defines how many products are present in the file.                                                                                                                                                                  |
| CARDSUM / TXREF                                      | M | N    | [1-20]  | Unique ID for the file generated by the Tribe system.                                                                                                                                                               |
| CARDSUM / ORDER_REF                                  | O | AN   | [1-16]  | Reserved for future use.                                                                                                                                                                                            |

```xml
<?xml version="1.0"?>
<CARDGEN>
  <PRODUCT>
    <PRODUCT_REF>CRV</PRODUCT_REF>
    <RECORD>
      <REQUEST_TYPE>New</REQUEST_TYPE>
      <UID>443</UID>
      <CARRIER>
        <TITLE/>
        <FNAME>test</FNAME>
        <SNAME>test</SNAME>
        <ADD1>Testing</ADD1>
        <ADD2/>
        <ADD3/>
        <ADD4/>
        <CITY>Testing</CITY>
        <POSTCODE>36666</POSTCODE>
        <COUNTRY>440</COUNTRY>
        <BULK_ADD1/>
        <BULK_ADD2/>
        <BULK_ADD3/>
        <BULK_CITY/>
        <BULK_POSTCODE/>
        <BULK_COUNTRY/>
        <CARRIER_TYPE>Default</CARRIER_TYPE>
        <CARRIER_LOGO_ID>1</CARRIER_LOGO_ID>
        <DELV_METHOD>1</DELV_METHOD>
        <DELV_CODE/>
        <FULFIL1/>
        <FULFIL2/>
        <LANG>EN</LANG>
      </CARRIER>
      <CARD>
        <TYPE>Chip&amp;Mag</TYPE>
        <CURRENCY>978</CURRENCY>
        <TRACK1>B****************^TEST/TEST^220422014507861000000</TRACK1>
        <TRACK2>****************=22042201450786100000</TRACK2>
        <TRACK3/>
        <EMBOSS_PAN>9999 9999 0000 9900</EMBOSS_PAN>
        <EMBOSS_NAME>TEST TEST</EMBOSS_NAME>
        <EMBOSS_START>08/19</EMBOSS_START>
        <EMBOSS_EXPIRY>04/22</EMBOSS_EXPIRY>
        <EMBOSS_CVC2>1234 567</EMBOSS_CVC2>
        <EMBOSS_LINE4/>
        <THERMAL_LINE1/>
        <THERMAL_LINE2/>
        <IMAGE_ID>1</IMAGE_ID>
        <LOGO_FRONT_ID>1</LOGO_FRONT_ID>
        <LOGO_BACK_ID>1</LOGO_BACK_ID>
        <QRCODE/>
        <CHIP>
          <NAME>test/test</NAME>
          <PAN>****************</PAN>
          <PAN_SEQ>00</PAN_SEQ>
          <START_DATE>190801</START_DATE>
          <EXPIRY_DATE>220430</EXPIRY_DATE>
          <SERVICE_CODE>220</SERVICE_CODE>
          <CHIP_TRACK_1>B****************^TEST/TEST^220422014507000000000</CHIP_TRACK_1>
          <CHIP_TRACK_2>****************D22042201450700000000F</CHIP_TRACK_2>
          <CHIP_TRACK_1_MSD_CL>B****************^ /^220422014507000000000</CHIP_TRACK_1_MSD_CL>
          <CHIP_TRACK_2_MSD_CL/>
          <PINBLOCK>123ABC123ABC123A</PINBLOCK>
        </CHIP>
      </CARD>
    </RECORD>
  </PRODUCT>
  <CARDSUM>
    <DATA_FORMAT_VERSION>9</DATA_FORMAT_VERSION>
    <FILEDATE>09-08-2019</FILEDATE>
    <FILETIME>14:05:39</FILETIME>
    <NO_OF_CARRIERS>14</NO_OF_CARRIERS>
    <NO_OF_CARDS>14</NO_OF_CARDS>
    <NO_OF_PRODUCTS>1</NO_OF_PRODUCTS>
    <TXREF>72</TXREF>
    <ORDER_REF/>
  </CARDSUM>
  ...
</CARDGEN>
```

# Appendix
## Changelog

| Version | Date          | Updates                                                                |
|---------|---------------|------------------------------------------------------------------------|
| 1.0.1   | July 15, 2022 | <!-- mij --> `CARDSUM` order changed and moved after the `PRODUCT`     |
| 1.0.0   | July 10, 2020 | <!-- air --> Initial version of card printer format specification      |

## Enum
### Card generation request type

|  Name   | Description |
|---------|-------------|
| New     |             |
| Reissue |             |

## Notation

### Parameter requirement

| Notation |    Meaning     |
|----------|----------------|
| M        | Mandatory      |
| O        | Optional       |
| C        | Conditional    |
| -        | Not applicable |

### Value type

| Notation  |             Meaning              |
|-----------|----------------------------------|
| Not blank | Not empty, not null, isset.      |
| A         | Alphabetic chars only.           |
| N         | Only numbers.                    |
| NS        | Numeric with symbols value.      |
| AN        | Alphanumeric value.              |
| ANS       | Alphanumeric with symbols value. |
| [1,2,3]   | Possible values: 1 or 2 or 3.    |
| [1-3]     | Range from 1 to 3.               |
| LIST      | List of values.                  |
| OBJ       | Object with properties.          |
| -         | Not applicable.                  |
