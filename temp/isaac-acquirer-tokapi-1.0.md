<!--
 # Introduction
 ## Using documentation
 ## API
 ### Overview
 ### Common workflows
-->
# Introduction
All API request examples provided in this document are for illustrative purposes only and request specifications for each method must be followed.

**Note: All request fields must be sent as string despite the field type differences, as fields are parsed to proper types.**

## Security

Please make sure to read appendix [`Security`](#appendix--security) before proceeding with using this API.

## Version

To see current version and details of recent changes, please see [`Changelog`](#appendix--changelog).

# Actions
## Tokenize

| URL              | Method |
|------------------|--------|
| /tokenizationapi | POST   |

### Request

| Parameter                            | M   | Type | Length | Description                                                                                                                                                  |
|:-------------------------------------|:----|:-----|:-------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| method                               | M   | AN   | 1-100  | Expected API method value: `tokenize`                                                                                                                        |
| token                                | M   | AN   | 1-20   | Merchant token                                                                                                                                               |
| terminal_id                          | M   | AN   | 1-8    | Terminal API ID                                                                                                                                              |
| sale_point_id                        | M   | AN   | 1-255  | Sale Point API ID                                                                                                                                            |
| api_id                               | M   | AN   | 1-8    | Merchant API ID                                                                                                                                              |
| api_version                          | M   | ANS  | 1-10   | Fixed `1.0`                                                                                                                                                  |
| idempotency_key                      | M   | ANS  | 1-255  | An idempotency key is a unique value generated by the client. Subsequent retries of the same request will return the same response. UUID is recommended.     |
| data                                 | M   | OBJ  | -      | Transaction data                                                                                                                                             |
| data / card_token                    | C   | AN   | 32     | [`Card token`](#appendix--security--card-token). Required if card data not set.                                                                              |
| data / card_number                   | C   | N    | 9-19   | Card number. Required if card token is not set.                                                                                                              |
| data / card_expiry_month             | C   | N    | 2      | Card expiration month. Required if card token is not set.                                                                                                    |
| data / card_expiry_year              | C   | N    | 2      | Card expiration year. Required if card token is not set.                                                                                                     |
| data / card_holder_name              | C   | A    | 1-27   | Card holder full name. Required if card token is not set.                                                                                                    |
| data / card_security_code            | O   | N    | 3      | Card security code.                                                                                                                                          |
| data / billing_address_city          | O   | ANS  | 1-32   | Cardholder billing address city.                                                                                                                             |
| data / billing_address_country       | O   | N    | 3      | Cardholder billing address ISO 3166-1 numeric three-digit country code.                                                                                      |
| data / billing_address_line1         | O   | ANS  | 1-64   | First line of the street address or equivalent local portion of the Cardholder billing address.                                                              |
| data / billing_address_line2         | O   | ANS  | 1-64   | Second line of the street address or equivalent local portion of the Cardholder billing address.                                                             |
| data / billing_address_post_code     | O   | ANS  | 1-16   | ZIP or other postal code of the Cardholder billing address.                                                                                                  |
| data / billing_address_state         | O   | A    | 1-12   | The state or province (country subdivision code) of the Cardholder billing address as defined in ISO 3166-2.                                                 |
| data / customer_phone_country_code   | O   | N    | 1-4    | The country code for the phone number. E.g. 1 for US or 44 for UK.                                                                                           |
| data / customer_phone                | O   | N    | 1-20   | The phone number of the account holder.                                                                                                                      |
| data / customer_language             | O   | A    | 2      | Language preference selected by the consumer. Formatted as an ISO-639-1 two-letter language code                                                             |
| data / device_score                  | O   | N    | 1      | Score assigned by the Token Requestor for the target device being provisioned. Must be a value from 1 to 5.                                                  |
| data / account_score                 | O   | N    | 1      | Score assigned by the Token Requestor for the consumer account or relationship. Must be a value from 1 to 5.                                                 |
| data / recommendation_reasons        | O   | LIST | -      | Code indicating the reasons the Token Requestor is suggesting the digitization decision. [`Recommendation Reasons`](#appendix--enum--recommendation-reasons) |
| data / device_location               | O   | NS   | 1-14   | Latitude and longitude in the format '(sign) latitude, (sign) longitude' with a precision of 2 decimal places.                                               |
| data / customer_ip                   | O   | NS   | 1-15   | The IP address of the device through which the device reaches the internet.                                                                                  |
| data / customer_mobile_number_suffix | O   | N    | 1-32   | The last few digits (typically four) of the consumer's mobile phone number as available on file or on the consumer's current device.                         |
| data / funding_account_source        | M   | AS   | 1-32   | The source of the account. [`Funding account source`](#appendix--enum--funding-account-source)                                                               |

```json
{
  "method": "tokenize",
  "api_id": "mer11",
  "token": "mer11",
  "terminal_id": "pa1bra",
  "sale_point_id": "mer11",
  "api_version": "1.0",
  "idempotency_key": "0b0606c8-0dcb-466f-965a-28157e22ca43",
  "data": {
    "card_number": "5123456789012345",
    "card_expiry_month": "09",
    "card_expiry_year": "21",
    "card_holder_name": "FIRSTNAME LASTNAME",
    "card_security_code": "123",
    "billing_address_line1": "100 1st Street",
    "billing_address_line2": "Apt. 4B",
    "billing_address_city": "St. Louis",
    "billing_address_state": "MO",
    "billing_address_post_code": "61000",
    "billing_address_country": "USA",
    "customer_phone_country_code": "44",
    "customer_phone": "07777777777",
    "customer_language": "en",
    "device_score": "1",
    "account_score": "1",
    "recommendation_reasons": [
      "LONG"
    ],
    "device_location": "38.63,-90.25",
    "customer_mobile_number_suffix": "3456",
    "customer_ip": "127.0.0.1",
    "funding_account_source": "ACCOUNT_ON_FILE"
  }
}
```

### Response

| Parameter                              | M   | Type | Length | Description                                                                                                                                               |
|:---------------------------------------|:----|:-----|:-------|:----------------------------------------------------------------------------------------------------------------------------------------------------------|
| status                                 | M   | A    | -      | [`Status`](#appendix--enum--status)                                                                                                                       |
| status_code                            | M   | N    | 3      | [`Status code`](#appendix--enum--status-code)                                                                                                             |
| response_data                          | M   | OBJ  | -      | Tokenization data                                                                                                                                         |
| response_data / token_unique_reference | C   | ANS  | 1-64   | The unique reference allocated to the new Token. Serves as a unique identifier for all subsequent queries or management functions relating to this Token. |
| response_data / decision               | C   | AS   | 8-33   | [`Decision`](#appendix--enum--decision)                                                                                                                   |
| response_data / status                 | M   | AS   | 1-32   | The current status of Token. [`Token Status`](#appendix--enum--token-status)                                                                              |
| response_data / token_expiry           | M   | N    | 4      | The expiry of the Token PAN, given in MMYY format.                                                                                                        |
| response_data / account_pan_expiry     | M   | N    | 4      | The expiry of the Account PAN, given in MMYY format.                                                                                                      |
| response_data / token_pan_suffix       | M   | N    | 1-8    | The last few digits (typically four) of the Token PAN.                                                                                                    |
| response_data / account_pan_suffix     | M   | N    | 1-8    | The last few digits (typically four) of the Account PAN.                                                                                                  |

**Note: in Sandbox mode the parameter token_unique_reference will always be identical with every request.**

```json
{
  "status": "success",
  "status_code": "000",
  "response_data": {
    "token_unique_reference": "DWSPMC000000000132d72d4fcb2f4136a0532d3093ff1a45",
    "decision": "APPROVED",
    "status": "ACTIVE",
    "token_expiry": "0724",
    "account_pan_expiry": "0921",
    "token_pan_suffix": "1234",
    "account_pan_suffix": "2345"
  }
}
```

## Get Token

| URL              | Method |
|------------------|--------|
| /tokenizationapi | POST   |

### Request

| Parameter                     | M   | Type | Length | Description                                                                                                                                              |
|:------------------------------|:----|:-----|:-------|:---------------------------------------------------------------------------------------------------------------------------------------------------------|
| method                        | M   | AN   | 1-100  | Expected API method value: `get_token`                                                                                                                   |
| token                         | M   | AN   | 1-20   | Merchant token                                                                                                                                           |
| terminal_id                   | M   | AN   | 1-8    | Terminal API ID                                                                                                                                          |
| sale_point_id                 | M   | AN   | 1-255  | Sale Point API ID                                                                                                                                        |
| api_id                        | M   | AN   | 1-8    | Merchant API ID                                                                                                                                          |
| api_version                   | M   | ANS  | 1-10   | Fixed `1.0`                                                                                                                                              |
| idempotency_key               | M   | ANS  | 1-255  | An idempotency key is a unique value generated by the client. Subsequent retries of the same request will return the same response. UUID is recommended. |
| data                          | M   | OBJ  | -      | Transaction data                                                                                                                                         |
| data / token_unique_reference | M   | ANS  | 1-64   | The specific Token to be queried.                                                                                                                        |
| data / include_token_detail   | O   | N    | -      | Flag to indicate if the encrypted token should be returned. Values: `0` - false, `1` - true.                                                             |

```json
{
  "method": "get_token",
  "api_id": "mer11",
  "token": "mer11",
  "terminal_id": "pa1bra",
  "sale_point_id": "mer11",
  "api_version": "1.0",
  "idempotency_key": "0b0606c8-0dcb-466f-965a-28157e22ca43",
  "data": {
    "token_unique_reference": "DWSPMC000000000132d72d4fcb2f4136a0532d3093ff1a45",
    "include_token_detail": "1"
  }
}
```

### Response

| Parameter                              | M   | Type | Length | Description                                                                                               |
|:---------------------------------------|:----|:-----|:-------|:----------------------------------------------------------------------------------------------------------|
| status                                 | M   | A    | -      | [`Status`](#appendix--enum--status)                                                                       |
| status_code                            | M   | N    | 3      | [`Status code`](#appendix--enum--status-code)                                                             |
| api_version                            | ME  | ANS  | 1-10   | Fixed `1.0`                                                                                               |
| response_data                          | M   | OBJ  | -      | Tokenization data                                                                                         |
| response_data / token_unique_reference | C   | ANS  | 1-64   | The specific Token to be queried.                                                                         |
| response_data / decision               | C   | AS   | 8-33   | [`Decision`](#appendix--enum--decision)                                                                   |
| response_data / status                 | M   | AS   | 1-32   | The current status of Token. [`Token Status`](#appendix--enum--token-status)                              |
| response_data / token_expiry           | M   | N    | 4      | The expiry of the Token PAN, given in MMYY format.                                                        |
| response_data / account_pan_expiry     | M   | N    | 4      | The expiry of the Account PAN, given in MMYY format.                                                      |
| response_data / token_pan_suffix       | M   | N    | 1-8    | The last few digits (typically four) of the Token PAN.                                                    |
| response_data / account_pan_suffix     | M   | N    | 1-8    | The last few digits (typically four) of the Account PAN.                                                  |
| response_data / token_pan              | C   | N    | 9-19   | The Primary Account Number for the transaction. This is the Token PAN.                                    |
| response_data / token_expiry_date      | C   | N    | 6      | Expiry date for the Token. Expressed in YYMMDD format.                                                    |
| response_data / pan_sequence_number    | C   | N    | 2      | Application PAN sequence number for the Token                                                             |
| response_data / track_2_equivalent     | C   | N    | 38     | Track 2 equivalent data for the Token.                                                                    |
| response_data / de_48_se_43_data       | C   | N    | 38     | Data for DE 48 Subelement 43 containing the cryptogram.                                                   |
| response_data / card_token             | C   | AN   | 32     | [`Card token`](#appendix--security--card-token). This field is returned if `Return card token` is enabled |

If tokenize action is already done and successful for this token, then all conditional parameters are returned.

```json
{
  "status": "success",
  "status_code": "000",
  "response_data": {
    "token_unique_reference": "DWSPMC000000000132d72d4fcb2f4136a0532d3093ff1a45",
    "decision": "APPROVED",
    "status": "ACTIVE",
    "token_expiry": "0724",
    "account_pan_expiry": "0921",
    "token_pan_suffix": "1234",
    "account_pan_suffix": "2345",
    "token_pan": "5480981500100002",
    "token_expiry_date": "210931",
    "pan_sequence_number": "01",
    "track_2_equivalent": "5480981500100002D18112011000000000000F",
    "de_48_se_43_data": "11223344556677889900112233445566778899",
    "card_token": "7d491f73e0a9523ba7ef91a692b75263"
  }
}
```

## Delete Token

| URL              | Method |
|------------------|--------|
| /tokenizationapi | POST   |

### Request

| Parameter                     | M   | Type | Length | Description                                                                                                                                              |
|:------------------------------|:----|:-----|:-------|:---------------------------------------------------------------------------------------------------------------------------------------------------------|
| method                        | M   | AN   | 1-100  | Expected API method value: `delete_token`                                                                                                                |
| token                         | M   | AN   | 1-20   | Merchant token                                                                                                                                           |
| terminal_id                   | M   | AN   | 1-8    | Terminal API ID                                                                                                                                          |
| sale_point_id                 | M   | AN   | 1-255  | Sale Point API ID                                                                                                                                        |
| api_id                        | M   | AN   | 1-8    | Merchant API ID                                                                                                                                          |
| api_version                   | M   | ANS  | 1-10   | Fixed `1.0`                                                                                                                                              |
| idempotency_key               | M   | ANS  | 1-255  | An idempotency key is a unique value generated by the client. Subsequent retries of the same request will return the same response. UUID is recommended. |
| data                          | M   | OBJ  | -      | Payload data                                                                                                                                             |
| data / token_unique_reference | M   | ANS  | 1-64   | The specific Token to be deleted.                                                                                                                        |
| data / caused_by              | M   | ANS  | 1-64   | Who or what caused the Token to be deleted. [`Caused By`](#appendix--enum--caused-by)                                                                    |
| data / reason                 | O   | ANS  | 1-256  | Free form reason why the Tokens are being suspended.                                                                                                     |
| data / reason_code            | M   | ANS  | 1-64   | The reason for the action to be deleted. [`Reason Code`](#appendix--enum--reason-code)                                                                   |

```json
{
  "method": "delete_token",
  "api_id": "mer11",
  "token": "mer11",
  "terminal_id": "pa1bra",
  "sale_point_id": "mer11",
  "api_version": "1.0",
  "idempotency_key": "0b0606c8-0dcb-466f-965a-28157e22ca43",
  "data": {
    "token_unique_reference": "DWSPMC000000000132d72d4fcb2f4136a0532d3093ff1a45",
    "caused_by": "CARDHOLDER",
    "reason": "Lost/stolen device",
    "reason_code": "SUSPECTED_FRAUD"
  }
}
```

### Response

| Parameter                              | M   | Type | Length | Description                                                                  |
|:---------------------------------------|:----|:-----|:-------|:-----------------------------------------------------------------------------|
| request_id                             | M   | N    | 14     | Request identification number                                                |
| status                                 | M   | A    | -      | [`Status`](#appendix--enum--status)                                          |
| status_code                            | M   | N    | 3      | [`Status code`](#appendix--enum--status-code)                                |
| api_version                            | ME  | ANS  | 1-10   | Fixed `1.0`                                                                  |
| response_data                          | M   | OBJ  | -      | Tokenization data                                                            |
| response_data / token_unique_reference | M   | ANS  | 1-64   | The specific Token to be queried.                                            |
| response_data / decision               | M   | AS   | 8-33   | [`Decision`](#appendix--enum--decision)                                      |
| response_data / status                 | M   | AS   | 1-32   | The current status of Token. [`Token Status`](#appendix--enum--token-status) |
| response_data / token_expiry           | M   | N    | 4      | The expiry of the Token PAN, given in MMYY format.                           |
| response_data / account_pan_expiry     | M   | N    | 4      | The expiry of the Account PAN, given in MMYY format.                         |
| response_data / token_pan_suffix       | M   | N    | 1-8    | The last few digits (typically four) of the Token PAN.                       |
| response_data / account_pan_suffix     | M   | N    | 1-8    | The last few digits (typically four) of the Account PAN.                     |

```json
{
  "request_id": "15598971077644",
  "status": "success",
  "status_code": "000",
  "response_data": {
    "token_unique_reference": "DWSPMC000000000132d72d4fcb2f4136a0532d3093ff1a45",
    "decision": "APPROVED",
    "status": "DEACTIVATED",
    "token_expiry": "0724",
    "account_pan_expiry": "0921",
    "token_pan_suffix": "1234",
    "account_pan_suffix": "2345"
  }
}
```

## Transact

| URL              | Method |
|------------------|--------|
| /tokenizationapi | POST   |

### Request

| Parameter                     | M   | Type | Length | Description                                                                                                                                              |
|:------------------------------|:----|:-----|:-------|:---------------------------------------------------------------------------------------------------------------------------------------------------------|
| method                        | M   | AN   | 1-100  | Expected API method value: `transact`                                                                                                                    |
| token                         | M   | AN   | 1-20   | Merchant token                                                                                                                                           |
| terminal_id                   | M   | AN   | 1-8    | Terminal API ID                                                                                                                                          |
| sale_point_id                 | M   | AN   | 1-255  | Sale Point API ID                                                                                                                                        |
| api_id                        | M   | AN   | 1-8    | Merchant API ID                                                                                                                                          |
| api_version                   | M   | ANS  | 1-10   | Fixed `1.0`                                                                                                                                              |
| idempotency_key               | M   | ANS  | 1-255  | An idempotency key is a unique value generated by the client. Subsequent retries of the same request will return the same response. UUID is recommended. |
| data                          | M   | OBJ  | -      | Payload data                                                                                                                                             |
| data / token_unique_reference | M   | ANS  | 1-64   | Globally unique identifier for the Token.                                                                                                                |
| data / unpredictable_number   | O   | HEX  | 8      | HEX Encoded data (case sensitive) to provide variability and uniqueness to the generation of a cryptogram.                                               |

```json
{
  "method": "transact",
  "api_id": "mer11",
  "token": "mer11",
  "terminal_id": "pa1bra",
  "sale_point_id": "mer11",
  "api_version": "1.0",
  "idempotency_key": "0b0606c8-0dcb-466f-965a-28157e22ca43",
  "data": {
    "token_unique_reference": "DWSPMC000000000132d72d4fcb2f4136a0532d3093ff1a45"
  }
}
```

### Response

| Parameter                              | M   | Type | Length | Description                                                                                                                       |
|:---------------------------------------|:----|:-----|:-------|:----------------------------------------------------------------------------------------------------------------------------------|
| request_id                             | M   | N    | 14     | Request identification number                                                                                                     |
| status                                 | M   | A    | -      | [`Status`](#appendix--enum--status)                                                                                               |
| status_code                            | M   | N    | 3      | [`Status code`](#appendix--enum--status-code)                                                                                     |
| api_version                            | ME  | ANS  | 1-10   | Fixed `1.0`                                                                                                                       |
| response_data                          | M   | OBJ  | -      | Token data                                                                                                                        |
| response_data / token_unique_reference | M   | ANS  | 1-64   | The specific Token to be queried.                                                                                                 |
| response_data / decision               | M   | AS   | 8-33   | [`Decision`](#appendix--enum--decision)                                                                                           |
| response_data / status                 | M   | AS   | 1-32   | The current status of Token. [`Token Status`](#appendix--enum--token-status)                                                      |
| response_data / token_expiry           | M   | N    | 4      | The expiry of the Token PAN, given in MMYY format.                                                                                |
| response_data / account_pan_expiry     | M   | N    | 4      | The expiry of the Account PAN, given in MMYY format.                                                                              |
| response_data / token_pan_suffix       | M   | N    | 1-8    | The last few digits (typically four) of the Token PAN.                                                                            |
| response_data / account_pan_suffix     | M   | N    | 1-8    | The last few digits (typically four) of the Account PAN.                                                                          |
| response_data / token_expiry_date      | M   | N    | 6      | Expiry date for the Token. Expressed in YYMMDD format.                                                                            |
| response_data / token_pan              | C   | N    | 9-19   | The Primary Account Number for the transaction. This is the Token PAN. This field is returned if `Return card token` is disabled. |
| response_data / pan_sequence_number    | C   | N    | 2      | Application PAN sequence number for the Token. This field is returned if `Return card token` is disabled.                         |
| response_data / track_2_equivalent     | C   | N    | 38     | Track 2 equivalent data for the Token. This field is returned if `Return card token` is disabled.                                 |
| response_data / de_48_se_43_data       | C   | N    | 38     | Data for DE 48 Subelement 43 containing the cryptogram. This field is returned if `Return card token` is disabled.                |
| response_data / card_token             | C   | AN   | 32     | [`Card token`](#appendix--security--card-token). This field is returned if `Return card token` is enabled.                        |

```json
{
  "request_id": "15598971077644",
  "status": "success",
  "status_code": "000",
  "response_data": {
    "token_unique_reference": "DWSPMC000000000132d72d4fcb2f4136a0532d3093ff1a45",
    "decision": "APPROVED",
    "status": "DEACTIVATED",
    "token_expiry": "0724",
    "account_pan_expiry": "0921",
    "token_pan_suffix": "1234",
    "token_pan": "5480981500100002",
    "token_expiry_date": "210931",
    "pan_sequence_number": "01",
    "track_2_equivalent": "5480981500100002D18112011000000000000F",
    "de_48_se_43_data": "11223344556677889900112233445566778899",
    "card_token": "7d491f73e0a9523ba7ef91a692b75263"
  }
}
```

# Appendix
## Changelog

| Version | Date              | Updates                                                                                                                         |
|:--------|:------------------|:--------------------------------------------------------------------------------------------------------------------------------|
| 1.1.0   | April 29, 2022    | <!-- tj --> Added new field `idempotency_key` to [`Delete Token`](#actions--delete-token) and [`Transact`](#actions--transact). |
| 1.0.0   | September 1, 2021 | <!-- tkm --> Initial version. <!-- Next version should be 1.1.0, then 1.1.1 etc., order descending, newest to oldest -->        |

## Enum

### Api methods

| Method       | Value        |
|:-------------|:-------------|
| Tokenize     | tokenize     |
| Get Token    | get_token    |
| Delete Token | delete_token |
| Transact     | transact     |

### Decision

| Decision                          |
|:----------------------------------|
| APPROVED                          |
| DECLINED                          |
| REQUIRE_ADDITIONAL_AUTHENTICATION |

### Funding account source

| Source                        |
|:------------------------------|
| ACCOUNT_ON_FILE               |
| ACCOUNT_ADDED_MANUALLY        |
| ACCOUNT_ADDED_VIA_APPLICATION |

### Recommendation Reasons

| Reason | Description                                                                                                                                                                                                                                                                                                                                                                |
|:-------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| LONG   | Account has existed for an extended period of not less than one year. A Token Requestor may determine a longer account tenure to qualify for this reason.                                                                                                                                                                                                                  |
| GOOD   | There has been financial activity linked to the account for at least and within a period of not less than six months; no suspicious activity is linked to the account within a period of at least one year.                                                                                                                                                                |
| ADDI   | The digitization is for an additional device for the same Account PAN and consumer account. There must be a currently active (not suspended) Token that was previously digitized and activated on an existing device for the same Account PAN and consumer account.                                                                                                        |
| SOFT   | The digitization has been requested due to an authenticated operating system or other software update being installed on the device, causing mobile payment data to be wiped and unable to be restored. This digitization must be for the same paymentAppInstanceId to which a Token was previously digitized and activated for the same Account PAN and consumer account. |
| ATNL   | Account is considered new relative to Token Requestor service launch                                                                                                                                                                                                                                                                                                       |
| ATNE   | Account is considered new relative to provisioning request                                                                                                                                                                                                                                                                                                                 |
| ACTN   | Account/card is considered new relative to provisioning request                                                                                                                                                                                                                                                                                                            |
| ARCH   | Changes have recently been made to account data                                                                                                                                                                                                                                                                                                                            |
| SUAC   | Suspicious activity has been linked to this account                                                                                                                                                                                                                                                                                                                        |
| INAC   | Inactive account                                                                                                                                                                                                                                                                                                                                                           |
| HAST   | Device contains suspended tokens                                                                                                                                                                                                                                                                                                                                           |
| DRLO   | Device has recently been reported lost                                                                                                                                                                                                                                                                                                                                     |
| TMRA   | Excessive recent tokenization attempts to this device                                                                                                                                                                                                                                                                                                                      |
| TMRT   | Excessive recent tokenizations to this device                                                                                                                                                                                                                                                                                                                              |
| TMDC   | Excessive non-matching cardholder names within the device                                                                                                                                                                                                                                                                                                                  |
| LODS   | Low device score                                                                                                                                                                                                                                                                                                                                                           |
| LOAS   | Low account score                                                                                                                                                                                                                                                                                                                                                          |
| OHOT   | Non-domestic tokenization attempt                                                                                                                                                                                                                                                                                                                                          |
| UTAS   | Unable to provide recommendation due to system issues.                                                                                                                                                                                                                                                                                                                     |
| HIRI   | High fraud risk identified. Enhanced authentication recommended.                                                                                                                                                                                                                                                                                                           |

### Status

| Status  |
|:--------|
| success |
| error   |

### Status code

| Status Code | Description                                                                                  |
|:------------|:---------------------------------------------------------------------------------------------|
| 000         | Success                                                                                      |
| 001         | Request message should have appropriate headers and be encrypted.                            |
| 002         | Invalid request data.                                                                        |
| 003         | Invalid credentials.                                                                         |
| 004         | Api version is invalid                                                                       |
| 005         | Merchant is not active                                                                       |
| 006         | Terminal is not active                                                                       |
| 007         | Sale point is not active                                                                     |
| 008         | Tokenization not allowed for scheme: (__SCHEME__).                                           |
| 009         | Sign header not provided                                                                     |
| 010         | Request decryption failed.                                                                   |
| 011         | Response encryption failed.                                                                  |
| 012         | Given sale point's token requestor id is not set.                                            |
| 094         | Terminal (__TERMINAL__) does not have permission to access method (__METHOD__).              |
| 274         | Terminal operation not available for method: (__METHOD__) with parameters: (__PARAMETERS__). |
| 995         | Api maintenance mode. Try again later.                                                       |
| 999         | Unknown error                                                                                |

### Token Status

| Value       | Meaning                                   |
|:------------|:------------------------------------------|
| INACTIVE    | Token has not yet been activated          |
| ACTIVE      | Token is active and ready to transact     |
| SUSPENDED   | Token is suspended and unable to transact |
| DEACTIVATED | Token has been permanently deactivated    |

### Caused By

| Value           | Meaning                                    |
|:----------------|:-------------------------------------------|
| CARDHOLDER      | Operation requested by the Cardholder      |
| TOKEN_REQUESTOR | Operation requested by the token requestor |

### Reason Code

| Value           | Meaning                                        |
|:----------------|:-----------------------------------------------|
| SUSPECTED_FRAUD | Token deletion in suspicion of fraudulent case |
| OTHER           | Token deletion for other reasons               |

## Security
### Authentication

To use the API you need to send your API credentials using header with every request you make.
**Note** If headers are set then appropriate values from JSON body will not be used.

**Header**

| Parameter       | Notation | Type | Length | Description                                                                                         |
|:----------------|:---------|:-----|:-------|:----------------------------------------------------------------------------------------------------|
| content-type    | M        | ANS  | 1-50   | Request content type. text/plain for encrypted request, application/json for non encrypted request. |
| x-method        | M        | A    | 1-50   | [`Api methods`](#appendix--enum--api-methods).                                                      |
| x-api-id        | M        | AN   | 50     | Merchant API ID.                                                                                    |
| x-terminal-id   | M        | AN   | 50     | Terminal API ID.                                                                                    |
| x-sale-point-id | M        | AN   | 50     | Sale point API ID.                                                                                  |
| x-token         | M        | AN   | 30-60  | Merchant token.                                                                                     |
| x-api-version   | M        | AN   | 1-3    | Fixed `1.0`.                                                                                        |
| x-sign          | M        | ANS  | 1-255  | "Secret" encrypted with merchant private key.                                                       |

### Card token

Card token is an internal system card hash which represents credit card’s details which includes *card_holder_name*, *card_number*, *card_expiry_month*, *card_expiry_year* fields. Provided by Tribe system.

### Cryptography
Request and response messages body should be encrypted.

**Request message data (from Client to API) encryption**

* Random secret of 32 characters length should be generated.
* Request message data should be encrypted with the random secret.
* Random secret should be encrypted using Client private key and must be provided in request message as (`sign`).
* Request message sign will be decrypted using the Client provided public key.
* The decrypted sign will be used as a _secret_ to decrypt the request message data.

**Response message data (from API to Client) encryption**

* Random secret of 32 characters length will be generated.
* Response message data will be encrypted with the random secret.
* Random secret will be encrypted using Tribe private key and it will be provided in response message as (`sign`).
* Response message sign should be decrypted using the Tribe provided public key.
* The decrypted sign should be used as a _secret_ to decrypt response message data.

Encrypted request/response body should be plain text. Private key must be in a PKCS #8 format. Public key can be extracted from private key using command `openssl rsa -in private.pem -pubout > public.pub` and should be provided to Tribe. **Examples for method request/response are provided in decrypted format**

**Encryption algorithm:**

```php
/**
 * @param array  $data
 * @param string $privateKey
 *
 * @return string
 */
public function encryptRequest(array $data, string $privateKey): string
{
    $secret = 'T3A7Ug7DbVN88qtsQ3jqdr3EfvVwbTif'; // randomly generated 32 characters string, which should be different on each request
    openssl_private_encrypt($secret, $bin, $privateKey);
    $sign = base64_encode($bin); // this sign will be used in header `x-sign`
    $iv = openssl_random_pseudo_bytes(16); 
    $encrypted = openssl_encrypt(json_encode($data), 'aes-256-cbc', $secret, OPENSSL_RAW_DATA, $iv);

    return bin2hex($iv).base64_encode($encrypted);
}
```

**Decryption algorithm:**

```php
/**
 * @param string $data
 * @param string $sign
 * @param string $publicKey
 *
 * @return string
 */
public function decryptResponse(string $data, string $sign, string $publicKey): string
{
    openssl_public_decrypt(base64_decode($sign), $secret, $publicKey);
    $iv = substr($data, 0, 32);
    $originalData = base64_decode(substr($data, 32));

    return openssl_decrypt($originalData, 'aes-256-cbc', $secret, OPENSSL_RAW_DATA, hex2bin($iv));
}
```

## Notation
### Parameter requirement

| Notation | Meaning                                                                                                                                                                              |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| M        | Mandatory                                                                                                                                                                            |
| O        | Optional                                                                                                                                                                             |
| C        | Conditional                                                                                                                                                                          |
| ME       | Mandatory Echo. The data element will be present in a response message and will contain the same value from the request.                                                             |
| CE       | Conditional Echo. The data element will be present in response message only if it was present in request message. If it was present it will contain the same value from the request. |
| -        | Not applicable                                                                                                                                                                       |

### Value type

| Notation  | Meaning                                        |
|:----------|:-----------------------------------------------|
| Not blank | Not empty, not null, isset                     |
| A         | Alphabetic chars only                          |
| N         | Only numbers                                   |
| NS        | Numeric with special symbols listed below      |
| AN        | Alphanumeric value                             |
| ANS       | Alphanumeric with special symbols listed below |
| [1,2,3]   | Possible values: 1 or 2 or 3                   |
| [1-3]     | Range from 1 to 3                              |
| LIST      | List of values                                 |
| OBJ       | Object with properties                         |
| -         | Not applicable                                 |

| Special symbol                                                       |
|----------------------------------------------------------------------|
| ! " # $ % & ' ( ) * + , - . / : ; < = > ? @ [ \ ] ^ _ ` { } ~ &#124; |
